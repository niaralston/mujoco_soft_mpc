<!-- 
INFLATABLE WALKER - BAYMAX-STYLE COMPLIANT ROBOT
==================================================

This model transforms a rigid walker into a compliant, inflatable robot similar to Baymax.
The thighs and shins are now made of flexible, deformable material that can:
- Compress and expand like inflatable balloons
- Absorb impacts through deformation
- Maintain structural integrity while being soft
- Provide natural damping through material properties

Key Features:
- Torso remains rigid for stability
- Thighs and shins are flexible components with trilinear interpolation
- Material properties simulate inflatable rubber/balloon behavior
- Joints connect flexible components to rigid torso
- Actuators control the flexible limbs through their attachment points
-->

<mujoco model="InflatableWalker">

  <!-- 
  SIMULATION SETTINGS FOR COMPLIANT MATERIALS
  ===========================================
  
  - timestep: Smaller timestep for stable flexible material simulation
  - solver: CG (Conjugate Gradient) for accurate flexible material physics
  - tolerance: High precision for stable deformations
  - integrator: Fast implicit integration for better performance with flexible materials
  -->
  <option timestep="0.002" solver="CG" tolerance="1e-6" integrator="implicitfast"/>

  <!-- Allocate memory for flexible component simulation -->
  <size memory="10M"/>

  <!-- 
  STATISTICS AND VISUALIZATION
  ============================
  
  - extent: Controls the size of the simulation world
  - center: Sets the center point for statistics calculation
  -->
  <statistic extent="2" center="0 0 1"/>

  <!-- 
  DEFAULT SETTINGS
  ================
  
  These apply to all elements unless overridden by specific components
  -->
  <default>
    <!-- Joint settings for connecting flexible components -->
    <joint damping=".1" armature="0.01" limited="true" solimplimit="0 .99 .01"/>
    
    <!-- Contact and friction settings for flexible materials -->
    <geom contype="1" conaffinity="0" friction=".7 .1 .1"/>
    
    <!-- Motor settings for controlling flexible limbs -->
    <motor ctrlrange="-1 1" ctrllimited="true"/>
    
    <!-- Site size for visualization -->
    <site size="0.01"/>
    
    <!-- Default class for rigid components (torso) -->
    <default class="rigid">
      <geom material="self" type="capsule"/>
      <joint axis="0 -1 0"/>
    </default>
    
    <!-- Default class for flexible components (thighs and shins) -->
    <default class="flexible">
      <!-- Flexible components will be defined individually -->
    </default>
  </default>

  <!-- 
  VISUALIZATION SETTINGS
  ======================
  
  - stiffness: Controls force vector visualization intensity
  - bv/bvactive: Makes collision bounding volumes invisible for cleaner visualization
  -->
  <visual>
    <map stiffness="100"/>
    <rgba bv="0 0 0 0" bvactive="0 0 0 0"/>
  </visual>

  <worldbody>
    <!-- 
    ENVIRONMENT
    ===========
    
    - floor: Ground plane for the walker to walk on
    - cameras: Multiple viewpoints to observe the flexible walker
    -->
    <geom name="floor" type="plane" conaffinity="1" pos="998 0 0" size="1000 .8 .2" material="blue_grid" zaxis="0 0 1"/>
    
    <!-- Camera viewpoints to observe the flexible walker -->
    <camera name="sideon" pos="0 -10 5" fovy="45" mode="targetbody" target="torso" />
    <camera name="float_far"  pos="-4 0 2" xyaxes="0 -1 0 .5 0 1" mode="trackcom" fovy="90"/>
    
    <!-- 
    TORSO (RIGID COMPONENT)
    ========================
    
    The torso remains rigid for stability and control. This provides a solid foundation
    for the flexible limbs to attach to, similar to how Baymax has a rigid core.
    -->
    <body name="torso" pos="0 0 1.3" childclass="rigid">
      <!-- Lighting and cameras attached to the rigid torso -->
      <light name="light" pos="0 0 2" mode="trackcom"/>
      <camera name="floating"  pos="-2 0 1" xyaxes="0 -1 0 .5 0 1" mode="trackcom" fovy="90"/>
      <camera name="egocentric"  pos=".25 0 .11" xyaxes="0 -1 0 0 0 1" fovy="90" />
      
      <!-- 
      ROOT JOINTS FOR TORSO MOVEMENT
      ===============================
      
      These joints allow the entire walker to move in 3D space:
      - rootz: Vertical movement (up/down)
      - rootx: Forward/backward movement
      - rooty: Rotation around vertical axis
      -->
      <joint name="rootz" axis="0 0 1" type="slide" limited="false" armature="0" damping="0"/>
      <joint name="rootx" axis="1 0 0" type="slide" limited="false" armature="0" damping="0"/>
      <joint name="rooty" axis="0 1 0" type="hinge" limited="false" armature="0" damping="0"/>
      
      <!-- Rigid torso geometry -->
      <geom name="torso" size="0.25 0.3" mass="10.673" zaxis="0 1 0"/>
      <site name="torso_site" pos="0 0 0" size="0.01"/>
      
      <!-- 
      RIGHT LEG - FLEXIBLE COMPONENTS
      ===============================
      
      The right leg consists of:
      1. A rigid hip joint connecting to the torso
      2. A flexible thigh that can deform like an inflatable balloon
      3. A rigid knee joint connecting thigh to shin
      4. A flexible shin that can also deform
      -->
      <body name="right_thigh" pos="0 -.3 -0.3">
        <!-- 
        HIP JOINT (RIGID)
        ==================
        
        This joint controls the hip movement. It remains rigid to provide
        precise control over the flexible thigh's orientation.
        -->
        <joint name="right_hip" range="-20 100"/>
        
        <!-- 
        FLEXIBLE THIGH (INFLATABLE BALLOON)
        ====================================
        
        This replaces the rigid capsule with a flexible component that:
        - Uses a 6x6x6 particle grid for deformation resolution
        - Has inflatable balloon-like properties
        - Can compress and expand naturally
        - Maintains volume through trilinear interpolation
        - Uses soft rubber-like material properties
        -->
        <flexcomp name="right_thigh_flex" type="ellipsoid" count="6 6 6" 
                  spacing=".08 .08 .08" pos="0 0 -0.225" dim="3"
                  radius=".001" rgba="0.8 0.2 0.2 0.8" mass="4.05789" dof="trilinear">
          <!-- 
          ELASTICITY PROPERTIES FOR INFLATABLE BEHAVIOR
          =============================================
          
          - young: 2e3 - Moderate stiffness, allows deformation but maintains shape
          - poisson: 0.45 - High volume preservation (like a balloon)
          - damping: 0.05 - Moderate damping for natural movement
          -->
          <elasticity young="2e3" poisson="0.45" damping="0.05"/>
          
          <!-- 
          CONTACT PROPERTIES
          ==================
          
          - selfcollide: "none" - No internal collisions within the flexible component
          - internal: false - No internal forces, shape maintained by trilinear interpolation
          - solref: Contact solver parameters for stable collision response
          -->
          <contact selfcollide="none" internal="false" solref="-5000 -10"/>
        </flexcomp>
        
        <!-- 
        KNEE JOINT AND SHIN
        ===================
        
        The knee joint connects the flexible thigh to the flexible shin.
        The shin is also flexible to create a fully compliant leg.
        -->
        <body name="right_leg" pos="0 0 -0.7">
          <!-- 
          KNEE JOINT (RIGID)
          ===================
          
          Rigid joint for precise knee control, connecting two flexible components.
          -->
          <joint name="right_knee" pos="0 0 0.25" range="-150 0"/>
          
          <!-- 
          FLEXIBLE SHIN (INFLATABLE BALLOON)
          ===================================
          
          Similar to the thigh but smaller and positioned at the lower leg.
          This creates a fully flexible lower limb that can absorb impacts.
          -->
          <flexcomp name="right_leg_flex" type="ellipsoid" count="6 6 6" 
                    spacing=".08 .08 .08" pos="0 0 0" dim="3"
                    radius=".001" rgba="0.8 0.2 0.2 0.8" mass="2.78136" dof="trilinear">
            <!-- 
            ELASTICITY PROPERTIES FOR SHIN
            ==============================
            
            Slightly different properties for the shin:
            - young: 2.5e3 - Slightly stiffer than thigh for better support
            - poisson: 0.45 - Same volume preservation
            - damping: 0.06 - Slightly more damping for stability
            -->
            <elasticity young="2.5e3" poisson="0.45" damping="0.06"/>
            <contact selfcollide="none" internal="false" solref="-5000 -10"/>
          </flexcomp>
        </body>
      </body>
      
      <!-- 
      LEFT LEG - FLEXIBLE COMPONENTS (MIRROR OF RIGHT)
      ================================================
      
      The left leg is identical to the right leg but mirrored.
      Both legs use the same flexible component approach.
      -->
      <body name="left_thigh" pos="0 .3 -0.3" >
        <!-- 
        LEFT HIP JOINT (RIGID)
        ======================
        
        Mirror of the right hip joint.
        -->
        <joint name="left_hip" range="-20 100"/>
        
        <!-- 
        FLEXIBLE LEFT THIGH (INFLATABLE BALLOON)
        =========================================
        
        Identical to right thigh but positioned on the left side.
        Same material properties for consistent behavior.
        -->
        <flexcomp name="left_thigh_flex" type="ellipsoid" count="6 6 6" 
                  spacing=".08 .08 .08" pos="0 0 -0.225" dim="3"
                  radius=".001" rgba="0.2 0.2 0.8 0.8" mass="4.05789" dof="trilinear">
          <!-- Same elasticity properties as right thigh -->
          <elasticity young="2e3" poisson="0.45" damping="0.05"/>
          <contact selfcollide="none" internal="false" solref="-5000 -10"/>
        </flexcomp>
        
        <!-- 
        LEFT KNEE AND SHIN
        ==================
        
        Mirror of the right knee and shin structure.
        -->
        <body name="left_leg" pos="0 0 -0.7">
          <!-- 
          LEFT KNEE JOINT (RIGID)
          =======================
          
          Mirror of the right knee joint.
          -->
          <joint name="left_knee" pos="0 0 0.25" range="-150 0"/>
          
          <!-- 
          FLEXIBLE LEFT SHIN (INFLATABLE BALLOON)
          =======================================
          
          Identical to right shin but positioned on the left side.
          Same material properties for consistent behavior.
          -->
          <flexcomp name="left_leg_flex" type="ellipsoid" count="6 6 6" 
                    spacing=".08 .08 .08" pos="0 0 0" dim="3"
                    radius=".001" rgba="0.2 0.2 0.8 0.8" mass="2.78136" dof="trilinear">
            <!-- Same elasticity properties as right shin -->
            <elasticity young="2.5e3" poisson="0.45" damping="0.06"/>
            <contact selfcollide="none" internal="false" solref="-5000 -10"/>
          </flexcomp>
        </body>
      </body>
    </body>
  </worldbody>

  <!-- 
  ACTUATORS FOR CONTROLLING THE FLEXIBLE LIMBS
  ============================================
  
  These motors control the rigid joints that connect the flexible components.
  The flexible components themselves deform naturally based on their material
  properties, while the joints provide the primary control for movement.
  
  Note: The flexible components will respond to forces and impacts naturally,
  but the primary locomotion control comes through these joint actuators.
  -->
  <actuator>
    <!-- Hip motors - control the connection between torso and flexible thighs -->
    <motor name="right_hip" joint="right_hip" gear="100"/>
    <motor name="left_hip" joint="left_hip" gear="100"/>
    
    <!-- Knee motors - control the connection between flexible thighs and shins -->
    <motor name="right_knee" joint="right_knee" gear="50"/>
    <motor name="left_knee" joint="left_knee" gear="50"/>
  </actuator>
</mujoco> 